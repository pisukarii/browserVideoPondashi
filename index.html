<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Visual Cue Stack Player - Pro Version</title>
    <style>
        :root { --bg: #1a1a1a; --panel: #252525; --active: #2e7d32; --accent: #0277bd; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #e0e0e0; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Header */
        header { background: #333; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #444; }
        .btn-group { display: flex; gap: 8px; }
        
        /* Layout */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Left: Editor */
        .sidebar { width: 320px; background: var(--panel); padding: 20px; border-right: 1px solid #444; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
        .input-card { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        .input-card h3 { margin: 0 0 15px 0; font-size: 14px; color: #888; border-bottom: 1px solid #444; padding-bottom: 5px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #aaa; }
        input[type="text"], input[type="file"] { width: 100%; margin-bottom: 12px; background: #111; border: 1px solid #555; color: white; padding: 8px; box-sizing: border-box; border-radius: 4px; }
        
        /* Right: Cue Stack */
        .cue-stack { flex: 1; padding: 20px; overflow-y: auto; background: #111; position: relative; }
        .go-panel { position: sticky; top: 0; background: #111; padding-bottom: 20px; z-index: 10; }
        .btn-go { background: #d32f2f; color: white; border: none; padding: 20px; font-size: 28px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; box-shadow: 0 6px #8b0000; transition: 0.1s; }
        .btn-go:active { box-shadow: 0 2px #8b0000; transform: translateY(4px); }
        
        /* Table Style */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #333; padding: 12px; text-align: left; font-size: 12px; color: #aaa; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #222; }
        .cue-row { cursor: pointer; transition: 0.2s; }
        .cue-row:hover { background: #1e1e1e; }
        .cue-row.active { background: var(--active) !important; box-shadow: inset 5px 0 0 #4caf50; }
        
        /* Buttons */
        button { cursor: pointer; padding: 8px 12px; border-radius: 4px; border: 1px solid #555; background: #444; color: white; font-size: 13px; }
        button:hover { background: #555; }
        .btn-blue { background: var(--accent); border: none; font-weight: bold; }
        .btn-green { background: #2e7d32; border: none; font-weight: bold; }
        .btn-small { padding: 4px 8px; font-size: 11px; }
    </style>
</head>
<body>

    <header>
        <div style="font-weight: bold; letter-spacing: 1px;">ğŸ“º BROWSER PONDASHI PRO</div>
        <div class="btn-group">
            <button class="btn-blue" onclick="openDisplay()">1. è¡¨ç¤ºç”»é¢ã‚’èµ·å‹•</button>
            <button class="btn-green" onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜ (Local)</button>
            <button onclick="loadSettings()">è¨­å®šã‚’å¾©å…ƒ</button>
        </div>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <div class="input-card">
                <h3>NEW CUE</h3>
                <label>Cue Name</label>
                <input type="text" id="cueName" placeholder="ä¾‹: 01_ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°æ˜ åƒ">
                
                <label>YouTube or Image URL</label>
                <input type="text" id="cueUrl" placeholder="https://...">
                
                <label>Local Video / Image File</label>
                <input type="file" id="fileInput" accept="video/*,image/*">
                
                <button class="btn-blue" style="width:100%" onclick="addCue()">Cueãƒªã‚¹ãƒˆã«è¿½åŠ </button>
            </div>
            <div style="font-size: 11px; color: #666; line-height: 1.6;">
                ã€Tipsã€‘<br>
                ãƒ»è¡¨ç¤ºç”»é¢ã‚’é–‹ã„ãŸã‚‰F11ã§å…¨ç”»é¢åŒ–ï¼<br>
                ãƒ»å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Œä¿å­˜ã€ã§ãã¾ã›ã‚“ï¼ˆãƒªã‚¹ãƒˆã®ä¸¦ã³é †ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ï¼‰ã€‚
            </div>
        </div>

        <div class="cue-stack">
            <div class="go-panel">
                <button class="btn-go" onclick="fireNext()">GO / NEXT CUE</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="40">No</th>
                        <th>Name</th>
                        <th width="80">Type</th>
                        <th width="160">Actions</th>
                    </tr>
                </thead>
                <tbody id="cueListBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let displayWindow = null;
        let cues = [];
        let currentIndex = -1;

        // 1. è¡¨ç¤ºã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®èµ·å‹• (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨å…¨ç”»é¢è¡¨ç¤ºã‚’ä¸¡ç«‹)
        function openDisplay() {
            displayWindow = window.open("", "DisplayWindow", "width=1280,height=720,menubar=no");
            if (displayWindow) {
                displayWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>DISPLAY OUT</title>
                        <style>
                            body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; }
                            #container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
                            iframe, video, img { width: 100%; height: 100%; border: none; object-fit: contain; }
                        </style>
                    </head>
                    <body><div id="container"></div></body>
                    </html>
                `);
                displayWindow.document.close();
            } else {
                alert("ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„ï¼");
            }
        }

        // 2. Cueã®è¿½åŠ 
        function addCue() {
            const name = document.getElementById('cueName').value || "Untitled Cue";
            const urlInput = document.getElementById('cueUrl').value;
            const fileInput = document.getElementById('fileInput');
            
            let cue = { name, type: "image", src: "" };

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                cue.type = file.type.startsWith('video') ? "video" : "image";
                cue.src = URL.createObjectURL(file); // ãƒ­ãƒ¼ã‚«ãƒ«ä¸€æ™‚URL
            } else if (urlInput.includes("youtube.com") || urlInput.includes("youtu.be")) {
                cue.type = "youtube";
                let vid = "";
                if(urlInput.value.includes("v=")) vid = urlInput.value.split("v=")[1].split("&")[0];
                else vid = urlInput.value.split("/").pop();
                cue.src = `https://www.youtube.com/embed/${vid}?autoplay=1&rel=0&enablejsapi=1`;
            } else {
                cue.src = urlInput;
            }

            cues.push(cue);
            render();
            // Reset
            document.getElementById('cueName').value = "";
            document.getElementById('cueUrl').value = "";
            document.getElementById('fileInput').value = "";
        }

        // 3. ãƒªã‚¹ãƒˆæç”»
        function render() {
            const body = document.getElementById('cueListBody');
            body.innerHTML = "";
            cues.forEach((c, i) => {
                const tr = document.createElement('tr');
                tr.className = `cue-row ${i === currentIndex ? 'active' : ''}`;
                tr.innerHTML = `
                    <td>${i + 1}</td>
                    <td><strong>${c.name}</strong></td>
                    <td><span style="font-size:10px; opacity:0.6">${c.type.toUpperCase()}</span></td>
                    <td>
                        <button class="btn-small" onclick="move(${i}, -1)">â†‘</button>
                        <button class="btn-small" onclick="move(${i}, 1)">â†“</button>
                        <button class="btn-small" style="color:#ff8888" onclick="remove(${i})">Ã—</button>
                        <button class="btn-small" onclick="fire(${i})">SELECT</button>
                    </td>
                `;
                body.appendChild(tr);
            });
        }

        // 4. é€å‡ºå®Ÿè¡Œ (é‡è¦)
        function fire(index) {
            if (!displayWindow || displayWindow.closed) return alert("è¡¨ç¤ºç”»é¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ã€Œè¡¨ç¤ºç”»é¢ã‚’èµ·å‹•ã€ã—ã¦ãã ã•ã„ã€‚");
            
            currentIndex = index;
            const cue = cues[index];
            const container = displayWindow.document.getElementById('container');
            
            if (cue.type === "youtube") {
                container.innerHTML = `<iframe src="${cue.src}" allow="autoplay; fullscreen"></iframe>`;
            } else if (cue.type === "video") {
                container.innerHTML = `<video src="${cue.src}" autoplay controls style="width:100%; height:100%;"></video>`;
            } else {
                container.innerHTML = `<img src="${cue.src}">`;
            }
            render();
        }

        function fireNext() {
            if (currentIndex < cues.length - 1) fire(currentIndex + 1);
        }

        // 5. ä¸¦ã³æ›¿ãˆãƒ»å‰Šé™¤
        function move(i, d) {
            if (i+d < 0 || i+d >= cues.length) return;
            [cues[i], cues[i+d]] = [cues[i+d], cues[i]];
            render();
        }
        function remove(i) {
            if(confirm("ã“ã®Cueã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) { cues.splice(i, 1); render(); }
        }

        // 6. ä¿å­˜æ©Ÿèƒ½ (ã‚¨ãƒ©ãƒ¼153å›é¿ï¼šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯ä¿å­˜ã›ãšæ§‹é€ ã®ã¿)
        function saveSettings() {
            const dataToSave = cues.map(c => ({
                name: c.name,
                type: c.type === 'youtube' ? 'youtube' : 'url',
                src: c.type === 'youtube' ? c.src : "" 
            }));
            localStorage.setItem('pondashi_v3_data', JSON.stringify(dataToSave));
            alert("ãƒªã‚¹ãƒˆæ§‹æˆã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚\nâ€»ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€å†èµ·å‹•å¾Œã«å†åº¦èª­ã¿è¾¼ã¾ã›ã¦ãã ã•ã„ã€‚");
        }

        function loadSettings() {
            const data = localStorage.getItem('pondashi_v3_data');
            if (data) {
                cues = JSON.parse(data);
                render();
            }
        }
    </script>
</body>
</html>
