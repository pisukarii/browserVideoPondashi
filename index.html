<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Browser Video Cue System</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #eee; margin: 20px; }
        .controls { margin-bottom: 20px; padding: 15px; background: #333; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #444; padding: 10px; text-align: left; }
        th { background: #444; }
        .cue-row:hover { background: #3a3a3a; }
        .active-cue { background: #2c5e2e !important; } /* å†ç”Ÿä¸­ã®è‰² */
        input, button { padding: 8px; cursor: pointer; }
        .btn-delete { background: #833; color: white; border: none; }
        .btn-go { background: #28a745; color: white; font-weight: bold; padding: 10px 20px; }
    </style>
</head>
<body>

    <h2>ğŸ¬ Browser Cue Stack System</h2>

    <div class="controls">
        <button onclick="openDisplay()">1. è¡¨ç¤ºã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã</button>
        <button onclick="saveSettings()">è¨­å®šã‚’ä¿å­˜ (Local)</button>
        <button onclick="loadSettings()">è¨­å®šã‚’èª­ã¿è¾¼ã¿</button>
        <hr>
        <input type="text" id="cueName" placeholder="Cueå (ä¾‹: OPæ˜ åƒ)">
        <input type="text" id="cueUrl" placeholder="URL (ç”»åƒãƒ»å‹•ç”»ãƒ»YouTube)">
        <button onclick="addCue()">Cueè¿½åŠ </button>
    </div>

    <div style="margin-bottom: 10px;">
        <button class="btn-go" onclick="fireNextCue()">NEXT CUE (GO!!)</button>
    </div>

    <table id="cueTable">
        <thead>
            <tr>
                <th>No.</th>
                <th>Cue Name</th>
                <th>Source URL</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="cueList">
            </tbody>
    </table>

    <script>
        let displayWindow = null;
        let cues = [];
        let currentCueIndex = -1;

        // è¡¨ç¤ºã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã
        function openDisplay() {
            displayWindow = window.open("", "DisplayWindow", "width=800,height=450");
            displayWindow.document.write(`
                <html><body style="margin:0; background:#000; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                    <div id="content" style="width:100%; height:100%;"></div>
                </body></html>
            `);
            displayWindow.document.title = "DISPLAY OUT";
        }

        // Cueã‚’è¿½åŠ 
        function addCue() {
            const name = document.getElementById('cueName').value;
            const url = document.getElementById('cueUrl').value;
            if(!url) return alert("URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            cues.push({ name, url });
            renderCues();
            document.getElementById('cueName').value = "";
            document.getElementById('cueUrl').value = "";
        }

        // Cueãƒªã‚¹ãƒˆã‚’æç”»
        function renderCues() {
            const list = document.getElementById('cueList');
            list.innerHTML = "";
            cues.forEach((cue, index) => {
                const row = document.createElement('tr');
                row.className = "cue-row" + (index === currentCueIndex ? " active-cue" : "");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${cue.name}</td>
                    <td style="font-size:0.8em; color:#aaa;">${cue.url}</td>
                    <td>
                        <button onclick="moveCue(${index}, -1)">â†‘</button>
                        <button onclick="moveCue(${index}, 1)">â†“</button>
                        <button class="btn-delete" onclick="deleteCue(${index})">å‰Šé™¤</button>
                        <button onclick="fireCue(${index})">é¸æŠ</button>
                    </td>
                `;
                list.appendChild(row);
            });
        }

        // ãƒãƒ³å‡ºã—å®Ÿè¡Œ
        function fireCue(index) {
            if (!displayWindow || displayWindow.closed) {
                alert("è¡¨ç¤ºã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã›ã‚“ï¼");
                return;
            }
            currentCueIndex = index;
            const cue = cues[index];
            const container = displayWindow.document.getElementById('content');
            
            // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ç°¡æ˜“åˆ¤åˆ¥
            if (cue.url.match(/\.(mp4|webm|ogg)$/i)) {
                container.innerHTML = `<video src="${cue.url}" autoplay style="width:100%; height:100%; object-fit:contain;"></video>`;
            } else {
                container.innerHTML = `<img src="${cue.url}" style="width:100%; height:100%; object-fit:contain;">`;
            }
            renderCues();
        }

        // æ¬¡ã®Cueã¸
        function fireNextCue() {
            let nextIndex = currentCueIndex + 1;
            if (nextIndex < cues.length) {
                fireCue(nextIndex);
            }
        }

        // å‰Šé™¤ãƒ»ä¸¦ã³æ›¿ãˆ
        function deleteCue(index) { cues.splice(index, 1); renderCues(); }
        function moveCue(index, direction) {
            const target = index + direction;
            if (target < 0 || target >= cues.length) return;
            [cues[index], cues[target]] = [cues[target], cues[index]];
            renderCues();
        }

        // å‚è€ƒã‚µã‚¤ãƒˆã®æ©Ÿèƒ½ã‚’ãƒªã‚¹ãƒšã‚¯ãƒˆã—ãŸä¿å­˜æ©Ÿèƒ½
        function saveSettings() {
            localStorage.setItem('cueData', JSON.stringify(cues));
            alert("ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã—ã¾ã—ãŸ");
        }

        function loadSettings() {
            const saved = localStorage.getItem('cueData');
            if (saved) {
                cues = JSON.parse(saved);
                renderCues();
            }
        }
    </script>
</body>
</html>
